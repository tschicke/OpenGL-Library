Try switching order of matrix multiplication in getBoneMatrix, rotateGlobal, and rotateLocal, and export blender quats in local space.